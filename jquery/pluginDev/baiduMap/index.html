<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    <style type="text/css">
        #map {
            width: 600px;
            height: 400px;
            background: yellow;
        }
        .BMapLabel {
            border:solid 0px !important;
            background-color: rgba(0,0,0,0) !important;
        }
        .BMapLabel p {
            background-image: url(zone.png); 
            text-align: center;
            color: white;
            font-weight: 600;
        }

        .BMapLabel p.grade1 {
            width: 80px;
            height: 51px;
            padding-top: 24px;
        }
        .BMapLabel p.grade1:hover {
            background-position: 0 -82px;
        }
        .BMapLabel p.grade2 {
            width: 46px;
            height: 44px;
            line-height: 44px;
            background-position: 0 130px;
        }
        .BMapLabel p.grade2:hover {
            background-position: 0 84px;
        }
        .BMapLabel p.grade3 {
            width: 36px;
            height: 33px;
            line-height: 33px;
            background-position: 37px 129px;
        }
        .BMapLabel p.grade3:hover {
            background-position: 37px 93px;
        }
        .BMapLabel p.grade3.clicked {
            background-position: 37px 57px;
        }
        .BMapLabel p.grade3.clicked:hover {
            background-position: 37px 93px;
        }
    </style>
</head>
<body>
<div id="map">
    
</div>

<script src="http://api.map.baidu.com/api?v=2.0&ak=108b50eb45abfdb30d056ec907130e22"></script>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript">

    (function($){
        var _default = {
            map: "",
            mapId: "map",
            center: {
                lng: 116.404,
                lat: 39.915
            },
            zoom: 11,
            ajaxUrl: "",
            ajaxData: {},
            ajaxMethod: "post",
            ajaxDataType: "json",
            ajaxSuccessMeth: function(data){
                                // _default.map.clearOverlays();
                                // // 判断地图等级添加不同的覆盖物
                                // if (data.mapZoom == "1") {
                                //     // 顶级
                                //     for (var i in data.resultList) {
                                //         var opts = {
                                //             position : new BMap.Point(resultList[i].lng, resultList[i].lat),
                                //             offset   : new BMap.Size(-33, -46)
                                //         }
                                //         var label = new BMap.Label("<p class='grade1'>" + resultList[i].zoneName + 
                                //                     "<br/>" + resultList[i].houseNum + "套</p>", opts);
                                //         label.addEventListener("click", function(){
                                //             _default.map.centerAndZoom(, )
                                //         })
                                //         map.addOverlay(label);
                                //     }
                                // } else if (data.mapZoom == "2") {
                                //     // 中级
                                //     var opts = {
                                //         position : new BMap.Point(_default.center.lng, _default.center.lat),
                                //         offset   : new BMap.Size(-14, -31)
                                //     }
                                //     var label = new BMap.Label("<p class='grade2'>" + resultList[i].houseNum + "套</p>", opts);
                                //     map.addOverlay(label);
                                // } else if (data.mapZoom == "3") {
                                //     // 低级
                                //     var opts = {
                                //         position : new BMap.Point(_default.center.lng, _default.center.lat),
                                //         offset   : new BMap.Size(-9, -25)// 小
                                //     }
                                //     var label = new BMap.Label("<p class='grade3 .clicked'>" + resultList[i].houseNum + "</p>", opts);
                                //     map.addOverlay(label);
                                // }
                            }
        };
        var methods = {
            init: function(options){
                _default = $.extend(_default, options || {});
                var map = new BMap.Map(this.attr("id"));    // 创建Map实例
                map.centerAndZoom(new BMap.Point(_default.center.lng, _default.center.lat), _default.zoom);  // 初始化地图,设置中心点坐标和地图级别
                map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
                _default.map = map;

                                var data = {
                                    mapZoom: "2",
                                    resultList: [
                                        {
                                            lng: 116.306533,
                                            lat:39.9948,
                                            zoneName: "海淀区",
                                            houseNum: 1000
                                        },
                                        {
                                            lng: 116.561796,
                                            lat: 39.988609,
                                            zoneName: "朝阳区",
                                            houseNum: 999
                                        },
                                        {
                                            lng: 116.383572,
                                            lat: 39.806159,
                                            zoneName: "丰台区",
                                            houseNum: 888
                                        }
                                    ]
                                }




                                _default.map.clearOverlays();
                                // 判断地图等级添加不同的覆盖物
                                var pDom = function(zoom, zoneName, houseNum) {
                                    if (zoneName != null && zoom == "1") {
                                        return "<p class='grade" + zoom + "'>" + zoneName + "<br/>" + houseNum + "套</p>";
                                    } else {
                                        return "<p class='grade" + zoom + "'>" + houseNum + "套</p>";
                                    }
                                }
                                var centerAndZoom = function (){
                                    var p = this.getPosition();
                                    p = new BMap.Point(p.lng, p.lat);
                                    _default.map.centerAndZoom(p, _default.map.getZoom() + 4)
                                }
                                if (data.mapZoom == "1") {
                                    var size = new BMap.Size(-33, -46);
                                } else if (data.mapZoom == "2") {
                                    var size = new BMap.Size(-14, -31);
                                } else if (data.mapZoom == "3") {
                                    var size = new BMap.Size(-9, -25);
                                } else if () {

                                }
                                for (var i in data.resultList) {
                                    var opts = {
                                        position : new BMap.Point(data.resultList[i].lng, data.resultList[i].lat),
                                        offset   : size
                                    }
                                    var label = new BMap.Label(pDom(data.mapZoom, data.resultList[i].zoneName,
                                                data.resultList[i].houseNum), opts);
                                    map.addOverlay(label);
                                    label.addEventListener("click" ,centerAndZoom);
                                }
                
                return this;
            },
            _getPositionAndZoom : function(map){
                var viewStatus = {};
                viewStatus.zoom = map.getZoom();
                viewStatus.max = map.getBounds().Sk;
                viewStatus.min = map.getBounds().gl;
                return viewStatus;
            },
            ajax: function(options) {
                $.extend(_default, options || {});
                $.ajax({
                    url: _default.ajaxUrl,
                    method: _default.ajaxMethod,
                    data: _default.ajaxData,
                    dataType: _default.ajaxDataType,
                    success: _default.ajaxSuccessMeth
                });
            },
            markerClusInit: function() {
                _default.map.addEventListener("moveend", methods.searchForResult);
                _default.map.addEventListener("zoomend", methods.searchForResult);
            },
            searchForResult: function(data){
                var option = {};
                $.extend(option.ajaxData, data || {}, methods._getPositionAndZoom(_default.map))
                methods.ajax(option);
            },
            getMap: function(){
                return _default.map;
            }
        };

        $.fn.baiduMap = function(method) {
            if (methods[method] && method.charAt(0) != "_") {
                methods[method].apply(this, Array.prototype.slice.call(arguments, 1))
            } else if (typeof method === "object" || !method) {
                methods.init.apply(this, arguments);
            } else {
                $.error("map plugin don't has the method" + method);
            }
        }
    })(jQuery);

    $("#map").baiduMap("init");
    $("#map").baiduMap("markerClusInit");



</script>
</body>
</html>